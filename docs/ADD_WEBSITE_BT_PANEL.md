# 在宝塔面板中添加网站

**目标**：配置网站和反向代理，让 LinkLore 可以通过域名访问  
**前提**：PM2 服务已正常运行（端口 3000）

---

## 一、目标（一句话）

在宝塔面板中添加网站，配置反向代理指向本地 3000 端口，并配置 SSL 证书。

---

## 二、变更清单

### 宝塔面板操作

**需要执行的操作**：
1. 添加网站（设置域名和根目录）
2. 配置反向代理（指向 `http://127.0.0.1:3000`）
3. 配置 SSL 证书（可选，但强烈推荐）

---

## 三、实现方案（面向非程序员）

### 为什么需要配置网站？

1. **域名访问**：让用户可以通过域名访问你的网站
2. **反向代理**：Nginx 将请求转发到 Node.js 应用（端口 3000）
3. **SSL 证书**：启用 HTTPS，保护数据传输安全

### 配置流程

1. **添加网站**：告诉宝塔面板你的域名和网站位置
2. **配置反向代理**：将域名请求转发到 Node.js 应用
3. **配置 SSL**：启用 HTTPS（免费证书）

---

## 四、详细操作步骤

### 步骤 1：添加网站（5分钟）

1. **登录宝塔面板**
   - 访问：`http://你的服务器IP:8888`
   - 使用用户名和密码登录

2. **进入网站管理**
   - 点击左侧菜单 **网站**
   - 点击 **添加站点** 按钮

3. **填写网站信息**
   - **域名**：填写你的域名
     - 例如：`www.linklore.com`
     - 如果有多个域名，每行一个：
       ```
       www.linklore.com
       linklore.com
       ```
   - **备注**：`LinkLore 应用`（可选）
   - **根目录**：`/www/wwwroot/linklore`（或保持默认）
   - **FTP**：不创建（不需要）
   - **数据库**：不创建（已存在）
   - **PHP 版本**：选择 **纯静态**（不需要 PHP）

4. **提交**
   - 点击 **提交** 按钮
   - 网站创建成功

---

### 步骤 2：配置反向代理（3分钟）

1. **进入网站设置**
   - 在网站列表中，找到你刚创建的网站
   - 点击右侧的 **设置** 按钮

2. **配置反向代理**
   - 点击 **反向代理** 标签
   - 点击 **添加反向代理** 按钮

3. **填写代理信息**
   - **代理名称**：`linklore`（任意名称）
   - **目标 URL**：`http://127.0.0.1:3000`
   - **发送域名**：`$host`
   - **其他选项**：保持默认

4. **保存**
   - 点击 **提交** 按钮
   - 反向代理配置完成

---

### 步骤 3：配置 SSL 证书（5分钟，推荐）

1. **进入 SSL 设置**
   - 在网站设置中，点击 **SSL** 标签

2. **申请免费证书**
   - 选择 **Let's Encrypt**（免费）
   - 勾选你的域名
   - 点击 **申请** 按钮
   - 等待证书申请完成（约 1-2 分钟）

3. **启用 HTTPS**
   - 申请成功后，开启 **强制 HTTPS**
   - 点击 **保存** 按钮

---

### 步骤 4：验证配置（2分钟）

1. **检查 PM2 服务**
   ```bash
   # 在宝塔终端中执行
   pm2 status
   ```
   - 应该看到所有服务都是 `online`

2. **访问网站**
   - 在浏览器中访问：`https://你的域名`
   - 应该看到 LinkLore 首页
   - 检查新样式是否正常显示（蓝色主题）

3. **测试功能**
   - 测试注册功能
   - 测试登录功能
   - 测试聊天功能
   - 测试图书馆功能

---

## 五、常见问题

### 问题 1：网站显示 502 Bad Gateway

**原因**：PM2 服务没有运行或端口不对

**解决方法**：
```bash
# 检查 PM2 状态
pm2 status

# 如果服务没有运行，启动它
pm2 restart ecosystem.config.js

# 检查端口 3000 是否被占用
netstat -tlnp | grep 3000
```

---

### 问题 2：反向代理配置后无法访问

**检查项**：
1. 目标 URL 是否正确：`http://127.0.0.1:3000`
2. PM2 服务是否运行：`pm2 status`
3. 防火墙是否开放 80/443 端口

---

### 问题 3：SSL 证书申请失败

**可能原因**：
1. 域名 DNS 未解析到服务器 IP
2. 80 端口被占用
3. 域名已申请过证书

**解决方法**：
1. 检查域名 DNS 解析：`ping 你的域名`
2. 检查 80 端口：`netstat -tlnp | grep 80`
3. 如果之前申请过，可以删除旧证书后重新申请

---

## 六、配置检查清单

完成配置后，检查以下项：

- [ ] 网站已添加
- [ ] 反向代理已配置（目标：`http://127.0.0.1:3000`）
- [ ] SSL 证书已申请并启用
- [ ] 强制 HTTPS 已开启
- [ ] PM2 服务正常运行
- [ ] 可以通过域名访问网站
- [ ] 新样式正常显示
- [ ] 主要功能正常

---

## 七、后续优化（可选）

### 1. 配置 CDN（如果使用）

如果使用 CDN，需要在 CDN 配置中：
- 源站设置为你的服务器 IP
- 回源协议选择 HTTPS

### 2. 配置缓存（可选）

在网站设置 → 性能优化中：
- 可以配置静态资源缓存
- 可以配置 Gzip 压缩

### 3. 配置防火墙

在宝塔面板 → 安全中：
- 开放 80 端口（HTTP）
- 开放 443 端口（HTTPS）
- 可以关闭 3000 端口（只允许本地访问）

---

**完成！你的网站现在可以通过域名访问了！**

