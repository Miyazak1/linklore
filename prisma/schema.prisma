generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String             @id @default(cuid())
  email                  String             @unique
  name                   String?
  avatarUrl              String? // 用户头像URL（可选，如果为空则使用默认头像）
  role                   String             @default("member")
  invitedBy              String?
  passwordHash           String
  createdAt              DateTime           @default(now())
  topics                 Topic[]
  documents              Document[]
  userConsensusAsUser1   UserConsensus[]    @relation("User1Consensus")
  userConsensusAsUser2   UserConsensus[]    @relation("User2Consensus")
  editorTraces           Trace[]            @relation("EditorTraces")
  topicComments          TopicComment[] // 用户发表的评论
  topicParticipants      TopicParticipant[] // 用户参与的话题讨论
  chatRoomsAsCreator     ChatRoom[]         @relation("ChatRoomCreator")
  chatRoomsAsParticipant ChatRoom[]         @relation("ChatRoomParticipant")
  chatMessages           ChatMessage[]      @relation("ChatMessageSender")
  issuePaths             IssuePath[] // 每日议题思考路径
  issueFeedbacks         IssueFeedback[] // 每日议题反馈
}

model Topic {
  id                 String              @id @default(cuid())
  title              String
  subtitle           String? // AI 生成的副标题（异步处理）
  authorId           String
  author             User                @relation(fields: [authorId], references: [id])
  discipline         String?
  createdAt          DateTime            @default(now())
  documents          Document[]
  consensusSnapshots ConsensusSnapshot[] // 共识快照
  userConsensus      UserConsensus[] // 用户对共识
  comments           TopicComment[] // 评论列表（不参与分析）
  commentCount       Int                 @default(0) // 评论计数（用于性能优化）
  participants       TopicParticipant[] // 参与讨论的用户

  @@index([authorId])
  @@index([createdAt])
  @@index([discipline])
}

model Document {
  id               String       @id @default(cuid())
  topicId          String
  topic            Topic        @relation(fields: [topicId], references: [id])
  parentId         String? // 父文档ID，null表示是主题文档
  parent           Document?    @relation("DocumentReplies", fields: [parentId], references: [id], onDelete: SetNull)
  replies          Document[]   @relation("DocumentReplies") // 子文档列表
  authorId         String
  author           User         @relation(fields: [authorId], references: [id])
  fileKey          String
  mime             String
  size             Int
  checksum         String?
  extractedText    Bytes?
  processingStatus Json? // 处理状态：{ extract: 'pending|processing|completed|failed', summarize: ..., evaluate: ... }
  lastProcessedAt  DateTime? // 最后处理时间
  createdAt        DateTime     @default(now())
  summaries        Summary[]
  evaluations      Evaluation[]

  @@index([topicId])
  @@index([parentId])
  @@index([authorId])
  @@index([createdAt])
}

model Summary {
  id            String   @id @default(cuid())
  documentId    String
  document      Document @relation(fields: [documentId], references: [id])
  title         String
  overview      String
  structure     Json
  claims        Json
  counterpoints Json
  keywords      String[]
}

model Evaluation {
  id            String   @id @default(cuid())
  documentId    String
  document      Document @relation(fields: [documentId], references: [id])
  discipline    String
  rubricVersion String
  scores        Json
  verdict       String
  createdAt     DateTime @default(now())
}

model UserAiConfig {
  id          String   @id @default(cuid())
  userId      String   @unique
  provider    String
  model       String
  encApiKey   String
  apiEndpoint String? // Optional custom API endpoint
  persist     Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model SystemAiConfig {
  id          String   @id @default(cuid())
  provider    String
  model       String
  encApiKey   String
  apiEndpoint String? // Optional custom API endpoint
  updatedBy   String // 最后更新的管理员用户ID
  updatedAt   DateTime @default(now()) @updatedAt
  createdAt   DateTime @default(now())

  @@unique([id]) // 确保只有一个系统配置
}

model AiUsageLog {
  id               String   @id @default(cuid())
  userId           String
  provider         String
  model            String
  promptTokens     Int
  completionTokens Int
  costCents        Int
  status           String
  createdAt        DateTime @default(now())
}

model Invitation {
  id        String    @id @default(cuid())
  code      String    @unique
  issuedBy  String?
  usedBy    String?
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  expiresAt DateTime?
}

model Book {
  id          String          @id @default(cuid())
  title       String
  author      String?
  coverUrl    String?
  overview    String?
  source      String? // openlibrary/google/manual
  category    String? // 分类：文学、科技、历史、哲学、艺术、教育、经济、心理学、小说、传记等
  tags        String[]        @default([]) // 标签数组，支持多标签
  language    String? // 语言：中文、英文、日文等
  isbn        String? // ISBN号
  publisher   String? // 出版社
  publishYear Int? // 出版年份
  createdAt   DateTime        @default(now())
  shelfItems  BookshelfItem[]
  assets      BookAsset[]

  @@index([category])
  @@index([language])
  @@index([publishYear])
}

model BookshelfItem {
  id        String   @id @default(cuid())
  userId    String
  bookId    String
  book      Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model BookAsset {
  id        String   @id @default(cuid())
  bookId    String
  book      Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  fileKey   String
  mime      String
  createdAt DateTime @default(now())
}

model Disagreement {
  id              String    @id @default(cuid())
  topicId         String
  title           String
  description     String? // AI 生成的详细描述
  status          String    @default("open") // open | researching | resolved | invalid
  ownerId         String?
  docIds          String[] // 涉及的文档ID数组
  doc1Id          String? // 文档1 ID（主要分歧方）
  doc2Id          String? // 文档2 ID（主要分歧方）
  claim1          String? // 观点1
  claim2          String? // 观点2
  severity        String? // high | medium | low
  confidence      Float? // AI 置信度 0-1
  aiGenerated     Boolean   @default(true) // 是否AI生成
  verified        Boolean   @default(false) // 是否经过人工验证
  falsePositive   Boolean   @default(false) // 是否被标记为误判
  analysisHash    String? // 分析时的文档内容hash（用于缓存验证）
  branchPath      String[] // 分歧发生的分支路径（树形结构）
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  lastValidatedAt DateTime? // 最后验证时间

  @@index([topicId])
  @@index([doc1Id])
  @@index([doc2Id])
  @@index([status])
  @@index([lastValidatedAt])
}

model ConsensusSnapshot {
  id              String   @id @default(cuid())
  topicId         String
  topic           Topic    @relation(fields: [topicId], references: [id])
  snapshotAt      DateTime @default(now())
  consensusData   Json // 存储共识分析结果
  consensusScore  Float? // 共识度分数（0-1，1表示完全一致）
  divergenceScore Float? // 分歧度分数（0-1，1表示完全分歧）

  @@index([topicId])
  @@index([snapshotAt])
}

model UserConsensus {
  id      String @id @default(cuid())
  topicId String
  userId1 String
  userId2 String
  user1   User   @relation("User1Consensus", fields: [userId1], references: [id])
  user2   User   @relation("User2Consensus", fields: [userId2], references: [id])
  topic   Topic  @relation(fields: [topicId], references: [id])

  consensus       Json // 共识点列表
  disagreements   Json // 分歧点列表
  consensusScore  Float? // 用户对之间的共识度（0-1）
  divergenceScore Float? // 用户对之间的分歧度（0-1）

  docIds          String[] // 涉及的所有文档ID
  discussionPaths Json // 讨论路径数组：[{path: [docId1, docId2, ...], depth: number, direction: string}]
  lastAnalyzedAt  DateTime? // 最后分析时间
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@unique([topicId, userId1, userId2])
  @@index([topicId])
  @@index([userId1])
  @@index([userId2])
  @@index([topicId, userId1])
  @@index([topicId, userId2])
}

// 溯源类型枚举
enum TraceType {
  CONCEPT // 概念
  EVENT // 事件
  FACT // 事实
  PERSON // 人物
  THEORY // 理论
  DEFINITION // 定义
}

// 溯源状态枚举
enum TraceStatus {
  DRAFT // 草稿（编辑中）
  PUBLISHED // 已发布（AI分析完成，等待采纳）
  ANALYZING // 分析中
  APPROVED // 已采纳（进入词条）
}

// 语义溯源模型（编辑创建）
model Trace {
  id       String @id @default(cuid())
  editorId String // 编辑ID（必须是editor或admin角色）
  editor   User   @relation("EditorTraces", fields: [editorId], references: [id])

  // 溯源目标
  title     String // 溯源标题（如"什么是量子纠缠？"）
  traceType TraceType // 溯源类型
  target    String // 溯源目标描述

  // 内容结构
  body      String // 正文内容（Markdown）
  citations Json // 引用列表：[{id, url, title, quote, author, year, type, order}]（冗余存储，用于快速访问）

  // 状态管理
  status      TraceStatus @default(DRAFT)
  publishedAt DateTime? // 发布时间（提交AI分析）
  analyzedAt  DateTime? // AI分析完成时间
  approvedAt  DateTime? // 采纳时间（进入词条）

  // AI分析结果
  analysis TraceAnalysis?

  // 引用列表
  citationsList Citation[]

  // 词条关联（如果被采纳）
  entry   Entry?
  entryId String? @unique

  // 版本历史（编辑可以修改）
  version           Int     @default(1)
  previousVersionId String? // 上一版本ID

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([editorId])
  @@index([status])
  @@index([traceType])
  @@index([publishedAt])
  @@index([status, publishedAt])
  @@index([editorId, status])
  @@index([traceType, status])
}

// 引用模型（结构化）
model Citation {
  id      String @id @default(cuid())
  traceId String
  trace   Trace  @relation(fields: [traceId], references: [id], onDelete: Cascade)

  // 引用信息
  url       String? // 来源URL
  title     String // 标题
  author    String? // 作者
  publisher String? // 出版机构
  year      Int? // 年份
  type      String // 类型：web, book, paper, journal, other
  quote     String? // 引用片段
  page      String? // 页码

  // 在正文中的位置
  bodyRefs String[] // 正文中引用此来源的位置标记（如["[1]", "[2]"]）

  // 元数据
  order     Int // 引用顺序
  createdAt DateTime @default(now())

  @@index([traceId])
  @@index([order])
}

// AI分析结果模型
model TraceAnalysis {
  id      String @id @default(cuid())
  traceId String @unique
  trace   Trace  @relation(fields: [traceId], references: [id], onDelete: Cascade)

  // 综合评分（0-1）
  credibilityScore   Float // 可信度评分（核心指标）
  completenessScore  Float? // 完整性评分
  accuracyScore      Float? // 准确性评分
  sourceQualityScore Float? // 来源质量评分

  // 详细分析
  analysis         Json // 详细分析结果
  strengths        String[] // 优点
  weaknesses       String[] // 不足
  missingAspects   String[] // 缺失的方面
  sourceEvaluation Json // 来源评估详情
  conflicts        Json? // 与其他来源的冲突

  // 建议
  suggestions String[] // 改进建议
  canApprove  Boolean // 是否可采纳（≥0.7）

  analyzedAt DateTime @default(now())

  @@index([traceId])
  @@index([credibilityScore])
}

// 词条模型（采纳自高可信度溯源）
model Entry {
  id String @id @default(cuid())

  // 词条基本信息
  title     String    @unique // 词条标题（唯一）
  slug      String    @unique // URL友好标识
  traceType TraceType // 类型

  // 内容（从溯源采纳并整理）
  content   String // 正文内容（Markdown，可能经过AI整理）
  citations Json // 引用列表（从溯源继承）

  // 来源溯源
  sourceTraceId String @unique
  sourceTrace   Trace  @relation(fields: [sourceTraceId], references: [id])

  // 版本管理
  version           Int     @default(1)
  previousVersionId String? // 上一版本ID（如果被更新）

  // 更新标记
  needsUpdate  Boolean @default(false) // 是否需要更新
  updateReason String? // 更新原因

  // 元数据
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  lastReviewedAt DateTime? // 最后审核时间

  @@index([slug])
  @@index([traceType])
  @@index([createdAt])
  @@index([traceType, createdAt])
  @@index([needsUpdate])
}

// 话题评论模型（非正式评论，不参与共识分析）
model TopicComment {
  id      String @id @default(cuid())
  topicId String
  topic   Topic  @relation(fields: [topicId], references: [id], onDelete: Cascade)

  // 简单嵌套（无深度限制，但需考虑显示方式）
  parentId String? // 父评论ID，null表示顶级评论
  parent   TopicComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: SetNull)
  replies  TopicComment[] @relation("CommentReplies")

  // 评论内容
  authorId String
  author   User   @relation(fields: [authorId], references: [id])
  content  String // Markdown格式的评论内容

  // 元数据
  depth     Int       @default(0) // 评论深度（用于显示，不做限制）
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // 软删除

  @@index([topicId])
  @@index([parentId])
  @@index([authorId])
  @@index([createdAt])
  @@index([topicId, parentId]) // 用于查询某个话题下的顶级评论
}

// 话题参与者模型（记录用户参与讨论的意图）
model TopicParticipant {
  id       String   @id @default(cuid())
  topicId  String
  topic    Topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)
  userId   String
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  joinedAt DateTime @default(now()) // 参与时间

  @@unique([topicId, userId]) // 每个用户在每个话题只能参与一次
  @@index([topicId])
  @@index([userId])
  @@index([topicId, userId])
}

// 每日百科游戏 - 题目表
model BaikeQuestion {
  id          String   @id @default(cuid())
  date        String   @unique // YYYYMMDD 格式，如 "20251219"
  title       String // 完整的百科标题（第一行）
  description String? // 可选：题目描述或提示
  category    String? // 可选：分类
  difficulty  Int? // 可选：难度等级 1-5
  createdAt   DateTime @default(now())

  // 关联的游戏记录
  gameRecords BaikeGameRecord[]

  @@index([date])
}

// 每日百科游戏 - 游戏记录表
model BaikeGameRecord {
  id            String        @id @default(cuid())
  questionId    String
  question      BaikeQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
  userId        String? // 可选，支持匿名用户
  date          String // YYYYMMDD 格式
  guessCount    Int           @default(0) // 猜测次数
  isCompleted   Boolean       @default(false) // 是否完成
  completedAt   DateTime? // 完成时间
  guesses       Json // 猜测历史：[{char: string, positions: number[], timestamp: string}]
  revealedChars Json // 已揭示的字符数组：string[]
  createdAt     DateTime      @default(now())

  @@unique([date, userId]) // 确保每个用户每天只有一条记录
  @@index([questionId])
  @@index([date])
  @@index([userId])
  @@index([date, userId]) // 每个用户每天只能有一条记录
}

// 聊天室类型枚举
enum ChatRoomType {
  SOLO
  DUO
}

// 聊天室状态枚举
enum ChatRoomStatus {
  ACTIVE
  ARCHIVED
  DISSOLVED
}

// 聊天室模型
model ChatRoom {
  id                         String         @id @default(cuid())
  type                       ChatRoomType // 'SOLO' | 'DUO'
  status                     ChatRoomStatus @default(ACTIVE) // 'ACTIVE' | 'ARCHIVED' | 'DISSOLVED'
  creatorId                  String
  creator                    User           @relation("ChatRoomCreator", fields: [creatorId], references: [id])
  participantId              String?
  participant                User?          @relation("ChatRoomParticipant", fields: [participantId], references: [id])
  creatorAiConfigId          String?
  participantAiConfigId      String?
  invitedAt                  DateTime?
  joinedAt                   DateTime?
  dissolvedAt                DateTime?
  archivedAt                 DateTime?
  topic                      String? // 讨论主题
  topicDescription           String? // 主题描述
  topicChangeRequest         String?
  topicChangeRequestedAt     DateTime?
  topicChangeRequestedBy     String?
  creatorDeletedAt           DateTime? // 创建者删除时间（软删除）
  participantDeletedAt       DateTime? // 参与者删除时间（软删除）
  creatorCharterAccepted     Boolean        @default(false)
  participantCharterAccepted Boolean        @default(false)
  createdAt                  DateTime       @default(now())
  updatedAt                  DateTime       @updatedAt

  messages ChatMessage[]
  analysis ChatAnalysis? @relation("ChatRoomAnalysis") // 分析结果（一对一）

  @@index([creatorId])
  @@index([participantId])
  @@index([status])
  @@index([updatedAt])
}

// 消息内容类型枚举（匹配数据库中的 MessageType）
enum MessageType {
  USER
  AI_SUGGESTION
  AI_ADOPTED
}

// 消息审核状态枚举（匹配数据库中的 ModerationStatus）
enum ModerationStatus {
  PENDING
  SAFE
  WARNING
  BLOCKED
}

// 聊天消息模型
model ChatMessage {
  id                   String            @id @default(cuid())
  roomId               String
  room                 ChatRoom          @relation(fields: [roomId], references: [id], onDelete: Cascade)
  senderId             String
  sender               User              @relation("ChatMessageSender", fields: [senderId], references: [id])
  content              String
  contentType          MessageType       @default(USER) // 'USER' | 'AI_SUGGESTION' | 'AI_ADOPTED'
  sequence             Int // 消息序号
  isAdopted            Boolean           @default(false) // 是否已采纳（用于AI建议）
  originalSuggestionId String? // 原始建议消息ID（如果采纳了AI建议）
  isStreaming          Boolean           @default(false) // 是否正在流式输出
  streamingCompleted   Boolean           @default(false) // 流式输出是否完成
  moderationStatus     ModerationStatus? // 'PENDING' | 'SAFE' | 'WARNING' | 'BLOCKED'
  moderationNote       String?
  moderationScore      Float? // 审核评分
  moderationDetails    Json? // 审核详情
  aiProvider           String?
  aiModel              String?
  deletedAt            DateTime? // 软删除
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt

  references   ChatMessageReference[] @relation("MessageReferences")
  referencedBy ChatMessageReference[]

  @@index([roomId])
  @@index([senderId])
  @@index([sequence])
  @@index([createdAt])
  @@index([roomId, sequence])
  @@index([roomId, deletedAt])
}

// 消息引用关系模型
model ChatMessageReference {
  id                  String      @id @default(cuid())
  messageId           String
  message             ChatMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  referencedMessageId String
  referencedMessage   ChatMessage @relation("MessageReferences", fields: [referencedMessageId], references: [id])
  createdAt           DateTime    @default(now())

  @@index([messageId])
  @@index([referencedMessageId])
}

// 聊天室分析结果模型
model ChatAnalysis {
  id                           String    @id @default(cuid())
  roomId                       String    @unique
  room                         ChatRoom  @relation("ChatRoomAnalysis", fields: [roomId], references: [id], onDelete: Cascade)
  consensusPoints              Json // 共识点列表
  consensusScore               Float // 共识度评分 0-1
  consensusTrend               Json // 共识趋势数据
  disagreementPoints           Json // 分歧点列表
  divergenceScore              Float // 分歧度评分 0-1
  divergenceTrend              Json // 分歧趋势数据
  averageDepth                 Float // 平均引用深度
  maxDepth                     Int // 最大引用深度
  totalReferences              Int // 总引用数
  aiAdoptionRate               Float // AI采纳率
  creatorMessageCount          Int // 创建者消息数
  participantMessageCount      Int // 参与者消息数
  creatorAiAdoptionCount       Int // 创建者AI采纳数
  participantAiAdoptionCount   Int // 参与者AI采纳数
  creatorAiSuggestionCount     Int // 创建者AI建议数
  participantAiSuggestionCount Int // 参与者AI建议数
  totalWarnings                Int       @default(0) // 总警告数
  creatorWarnings              Int       @default(0) // 创建者警告数
  participantWarnings          Int       @default(0) // 参与者警告数
  blockedMessages              Int       @default(0) // 被屏蔽消息数
  lastAnalyzedAt               DateTime? // 最后分析时间
  updatedAt                    DateTime  @updatedAt

  @@index([roomId])
  @@index([lastAnalyzedAt])
}

// 每日议题思考游戏 - 每日议题表
model DailyIssue {
  id              String   @id @default(cuid())
  date            String   @unique // YYYYMMDD格式，如 "20250120"
  title           String // 议题标题
  caseDescription String // 阶段0：案例描述
  status          String   @default("draft") // draft | published | archived
  difficulty      Int? // 1-5难度等级
  category        String? // 分类
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // 关联数据
  nodes     IssueNode[]
  paths     IssuePath[]
  results   IssueResult[]
  feedbacks IssueFeedback[]
  analytics IssueAnalytics?

  @@index([date])
  @@index([status])
  @@index([status, date])
}

// 每日议题思考游戏 - 决策树节点表
model IssueNode {
  id            String     @id @default(cuid())
  issueId       String
  issue         DailyIssue @relation(fields: [issueId], references: [id], onDelete: Cascade)
  stage         Int // 0-5，阶段编号
  nodeKey       String // 节点唯一标识，如 "stage1_optionA"
  title         String // 节点标题/问题
  content       String // 节点内容/选项文本
  parentNodeKey String? // 父节点key，用于构建树
  nextNodeKeys  Json // 下一节点数组，支持分支：["stage2_optionA", "stage2_optionB"]
  isRoot        Boolean    @default(false) // 是否为根节点
  order         Int // 同阶段内的顺序

  @@unique([issueId, nodeKey]) // 确保同一议题内nodeKey唯一
  @@index([issueId])
  @@index([issueId, stage])
  @@index([issueId, nodeKey])
}

// 每日议题思考游戏 - 用户思考路径记录表
model IssuePath {
  id          String     @id @default(cuid())
  issueId     String
  issue       DailyIssue @relation(fields: [issueId], references: [id], onDelete: Cascade)
  userId      String? // 可选，支持匿名用户
  user        User?      @relation(fields: [userId], references: [id], onDelete: SetNull)
  date        String // YYYYMMDD格式，记录日期
  path        Json // 完整路径：[{stage: number, nodeKey: string, selectedAt: string}]
  completedAt DateTime? // 完成时间
  createdAt   DateTime   @default(now())

  // 关联反馈
  feedbacks IssueFeedback[]
  // 注意：由于userId可能为null，不能使用unique约束
  // 需要在应用层确保每个用户每天每个议题只有一条记录

  @@index([issueId])
  @@index([userId])
  @@index([date])
  @@index([issueId, date])
}

// 每日议题思考游戏 - 结果页模板表
model IssueResult {
  id             String     @id @default(cuid())
  issueId        String
  issue          DailyIssue @relation(fields: [issueId], references: [id], onDelete: Cascade)
  pathPattern    Json // 路径模式匹配规则：{stages: [0,1,2,3,4,5], nodeKeys: ["stage0", "stage1_optionA", ...]}
  resultTemplate Json // 结果页模板结构：{tradeoff: string, alternative: string, question: string}
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@index([issueId])
}

// 每日议题思考游戏 - 用户反馈表
model IssueFeedback {
  id             String     @id @default(cuid())
  issueId        String
  issue          DailyIssue @relation(fields: [issueId], references: [id], onDelete: Cascade)
  userId         String? // 可选，支持匿名用户
  user           User?      @relation(fields: [userId], references: [id], onDelete: SetNull)
  pathId         String? // 关联IssuePath
  path           IssuePath? @relation(fields: [pathId], references: [id], onDelete: SetNull)
  helpful        Boolean? // 是否帮助思考
  confusingStage Int? // 哪个阶段最困惑（0-5）
  isNeutral      Boolean? // 是否中立
  comment        String? // 建议
  createdAt      DateTime   @default(now())

  @@index([issueId])
  @@index([userId])
  @@index([pathId])
}

// 每日议题思考游戏 - 数据分析表（后台使用）
model IssueAnalytics {
  id               String     @id @default(cuid())
  issueId          String     @unique
  issue            DailyIssue @relation(fields: [issueId], references: [id], onDelete: Cascade)
  date             String // YYYYMMDD格式
  totalAttempts    Int        @default(0) // 总尝试次数
  completionRate   Float      @default(0) // 完成率 0-1
  pathDistribution Json // 路径分布统计：{path1: count, path2: count, ...}
  averageTime      Int? // 平均完成时间，秒
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  @@index([date])
}
